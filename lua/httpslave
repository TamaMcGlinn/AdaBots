local default_server = "http://localhost:7112/"

print("")
print("Please enter a listen URL")
print("It should be [IP_address]:[port]")
print("Where IP_address is the IP of the")
print("computer running an Adabots program")
print("The port is in your Ada program")
print("Just press enter for the default:")
print(default_server)
print("")

local server = read()
if server == "" then
  server = default_server
end

while true do

  local request = nil
  repeat
    request = http.get(server)
    if not request then
      os.sleep(1)
    end
  until request

  local command = request.readAll()
  local functor = loadstring("return(" .. command .. ")")

  local result = nil
  if functor then
    result = tostring(functor())
  else
    result = "error: invalid lua expression"
  end
  print(command .. " returned " .. result)

  http.get(server .. "return_value/" .. result)

  request.close()

end
